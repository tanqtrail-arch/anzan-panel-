<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>ÊöóÁÆó„Éë„Éç„É´</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Dela+Gothic+One&family=Zen+Maru+Gothic:wght@400;700;900&display=swap');
:root{--bg:#e8f4ff;--pr:#ff5577;--pb:#44aaff;--pg:#44dd77;--py:#ffcc22;--pp:#aa66ff;--po:#ff8844;
  --txt:#334;--dim:#7788aa;--dng:#ff3355;--ok:#22cc66;--card:rgba(255,255,255,.85);--bot:rgba(255,255,255,.92);
  --alt:#22bb55;--altbg:linear-gradient(135deg,#e8ffe8,#d0f5d0);}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Zen Maru Gothic',sans-serif;background:var(--bg);color:var(--txt);min-height:100vh;overflow:hidden;
  user-select:none;-webkit-user-select:none;touch-action:manipulation;}
.bubbles{position:fixed;inset:0;pointer-events:none;z-index:999;overflow:hidden;}
.bubble{position:absolute;border-radius:50%;opacity:.3;animation:fU linear infinite;}
@keyframes fU{0%{transform:translateY(100vh) scale(.3);opacity:0;}10%{opacity:.3;}90%{opacity:.25;}100%{transform:translateY(-10vh) scale(1);opacity:0;}}
.alt-badge{position:fixed;top:12px;right:12px;z-index:1000;display:flex;align-items:center;gap:5px;
  background:var(--altbg);padding:6px 14px;border-radius:24px;font-family:'Dela Gothic One',sans-serif;
  font-size:15px;color:#227744;border:2px solid rgba(34,187,85,.25);box-shadow:0 2px 10px rgba(34,187,85,.12);}
.alt-badge.hide{display:none;}
.float-alt{position:fixed;z-index:1001;pointer-events:none;font-family:'Dela Gothic One',sans-serif;
  font-size:28px;color:var(--alt);text-shadow:0 1px 4px rgba(0,0,0,.1);animation:fA .8s ease-out forwards;}
@keyframes fA{0%{opacity:1;transform:translateY(0) scale(1);}100%{opacity:0;transform:translateY(-60px) scale(1.2);}}
.screen{display:none;height:100vh;width:100vw;position:absolute;top:0;left:0;}
.screen.active{display:flex;flex-direction:column;align-items:center;}
#title{justify-content:center;gap:24px;background:linear-gradient(180deg,#d4ecff,#e8f4ff,#f0e8ff);position:relative;overflow:hidden;}
.logo{font-family:'Dela Gothic One',sans-serif;font-size:clamp(40px,10vw,80px);text-align:center;z-index:2;line-height:1.2;}
.logo span{display:inline-block;filter:drop-shadow(0 3px 0 rgba(0,0,0,.1));}
.logo .l1{color:var(--pr);}.logo .l2{color:var(--py);}.logo .l3{color:var(--pg);}.logo .l4{color:var(--pb);}.logo .l5{color:var(--pp);}
.tsub{font-size:clamp(12px,3vw,16px);color:var(--dim);z-index:2;text-align:center;letter-spacing:2px;}
.btn{font-family:'Zen Maru Gothic',sans-serif;font-weight:900;border:none;border-radius:12px;cursor:pointer;transition:all .12s;letter-spacing:1px;}
.btn:active{transform:scale(.94);}
.btn-start{font-size:22px;padding:16px 52px;z-index:2;background:linear-gradient(180deg,#ff7799,#ff5577);color:#fff;border-radius:50px;box-shadow:0 4px 0 #cc3355,0 8px 24px rgba(255,85,119,.25);}
#map{padding:20px;gap:16px;overflow-y:auto;background:linear-gradient(180deg,#d4ecff,var(--bg));padding-bottom:280px;}
.mt{font-family:'Dela Gothic One',sans-serif;font-size:clamp(20px,5vw,30px);color:var(--pb);}
.ts{font-size:15px;color:var(--dim);}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px;width:100%;max-width:900px;}
.cd{background:var(--card);backdrop-filter:blur(8px);border-radius:18px;padding:20px;cursor:pointer;transition:all .2s;
  border:2px solid rgba(0,0,0,.06);position:relative;overflow:hidden;box-shadow:0 2px 12px rgba(0,0,0,.06);}
.cd::before{content:'';position:absolute;top:0;left:0;right:0;height:5px;border-radius:18px 18px 0 0;}
.cd[data-i="0"]::before{background:var(--pr);}.cd[data-i="1"]::before{background:var(--po);}
.cd[data-i="2"]::before{background:var(--pg);}.cd[data-i="3"]::before{background:var(--pb);}
.cd[data-i="4"]::before{background:var(--pp);}
.cd:active{transform:scale(.97);}
.cd.cl::after{content:'‚≠ê';position:absolute;top:12px;right:12px;font-size:20px;}
.cd-e{font-size:32px;margin-bottom:4px;}.cd-n{font-family:'Dela Gothic One',sans-serif;font-size:18px;margin-bottom:3px;}
.cd-s{font-size:12px;color:var(--dim);margin-bottom:6px;}.cd-d{font-size:12px;color:var(--dim);}
.cd-b{font-size:11px;color:var(--dim);margin-top:6px;}
.lsec{width:100%;max-width:900px;margin-top:24px;background:var(--card);backdrop-filter:blur(8px);border-radius:18px;
  padding:20px;border:2px solid rgba(0,0,0,.06);box-shadow:0 2px 12px rgba(0,0,0,.06);}
.lt{font-family:'Dela Gothic One',sans-serif;font-size:16px;margin-bottom:12px;}
.lr{display:flex;gap:8px;margin-bottom:10px;align-items:center;flex-wrap:wrap;}
.li{flex:1;min-width:120px;padding:10px 14px;border-radius:12px;border:2px solid rgba(0,0,0,.08);
  font-family:'Zen Maru Gothic',sans-serif;font-size:14px;background:#fff;color:var(--txt);outline:none;}
.li:focus{border-color:var(--pb);}
.btn-ln{padding:10px 20px;font-size:14px;border-radius:12px;background:linear-gradient(180deg,#44cc66,#22aa44);color:#fff;box-shadow:0 3px 0 #118833;}
.btn-ln:disabled{background:#ccc;color:#999;box-shadow:none;cursor:not-allowed;transform:none;}
.lnt{font-size:11px;color:var(--dim);}
.lcf{display:none;position:fixed;inset:0;background:rgba(255,255,255,.88);backdrop-filter:blur(8px);z-index:2000;
  justify-content:center;align-items:center;flex-direction:column;gap:14px;}
.lcf.active{display:flex;}
.lct{font-family:'Dela Gothic One',sans-serif;font-size:18px;text-align:center;padding:0 20px;}
.lcw{font-size:13px;color:var(--dng);text-align:center;}
.lcb{display:flex;gap:10px;}
.btn-lcc{padding:10px 24px;font-size:14px;border-radius:50px;background:rgba(0,0,0,.06);color:var(--txt);}
.btn-lco{padding:10px 24px;font-size:14px;border-radius:50px;background:linear-gradient(180deg,#44cc66,#22aa44);color:#fff;box-shadow:0 3px 0 #118833;}
#game{background:var(--bg);flex-direction:column;}
.gtop{width:100%;padding:8px 16px;display:flex;justify-content:space-between;align-items:center;flex-shrink:0;z-index:20;
  background:rgba(255,255,255,.7);backdrop-filter:blur(8px);border-bottom:1px solid rgba(0,0,0,.06);}
.ginf{font-family:'Dela Gothic One',sans-serif;font-size:14px;}
.grt{display:flex;gap:8px;font-size:12px;align-items:center;}
.grt span{display:flex;align-items:center;gap:3px;background:rgba(0,0,0,.05);padding:4px 10px;border-radius:20px;font-weight:700;}
.gtb{width:100%;height:6px;background:rgba(0,0,0,.06);flex-shrink:0;}
.gtf{height:100%;background:var(--ok);transition:width .2s linear;border-radius:0 3px 3px 0;}
.gtf.tw{background:var(--py);}.gtf.td{background:var(--dng);}
.gdz{width:100%;position:relative;flex-shrink:0;height:3px;z-index:10;}
.gdl{position:absolute;top:0;left:0;right:0;height:3px;background:repeating-linear-gradient(90deg,var(--dng) 0,var(--dng) 10px,transparent 10px,transparent 20px);opacity:.4;animation:dp 1s ease-in-out infinite alternate;}
@keyframes dp{0%{opacity:.25;}100%{opacity:.55;}}
.gdlb{position:absolute;top:6px;right:10px;font-size:9px;color:var(--dng);opacity:.7;font-weight:700;}
.gpan{flex:1;width:100%;overflow:hidden;display:flex;flex-direction:column-reverse;align-items:center;padding:8px 10px;gap:6px;}
.panel{width:100%;max-width:540px;border-radius:14px;padding:14px 16px;display:flex;justify-content:center;align-items:center;
  cursor:pointer;transition:all .12s;flex-shrink:0;animation:pR .3s cubic-bezier(.2,1,.3,1);position:relative;
  font-family:'Dela Gothic One',sans-serif;font-size:clamp(22px,5vw,32px);letter-spacing:3px;text-align:center;
  color:#fff;text-shadow:0 2px 0 rgba(0,0,0,.15);border:3px solid rgba(255,255,255,.5);
  box-shadow:inset 0 2px 0 rgba(255,255,255,.4),inset 0 -3px 0 rgba(0,0,0,.1),0 4px 0 rgba(0,0,0,.08);}
.panel.pc0{background:linear-gradient(180deg,#ff8899,#ff5577);}.panel.pc1{background:linear-gradient(180deg,#66bbff,#3399ee);}
.panel.pc2{background:linear-gradient(180deg,#66ee88,#33bb55);}.panel.pc3{background:linear-gradient(180deg,#ffdd55,#eebb00);color:#665500;text-shadow:0 1px 0 rgba(255,255,255,.4);}
.panel.pc4{background:linear-gradient(180deg,#bb88ff,#9955ee);}.panel.pc5{background:linear-gradient(180deg,#ffaa66,#ee7733);}
.panel.sel{border-color:#fff;box-shadow:inset 0 2px 0 rgba(255,255,255,.4),inset 0 -3px 0 rgba(0,0,0,.1),0 0 0 4px rgba(68,170,255,.3),0 4px 0 rgba(0,0,0,.08);}
.panel:active{transform:scale(.97);}
@keyframes pR{0%{transform:translateY(50px);opacity:0;}100%{transform:translateY(0);opacity:1;}}
.panel.shatter{animation:pP .3s ease-out forwards;pointer-events:none;}
@keyframes pP{0%{transform:scale(1);opacity:1;}40%{transform:scale(1.15);filter:brightness(1.5);}100%{transform:scale(0);opacity:0;filter:brightness(2);}}
.panel.shake{animation:sk .25s ease;}
@keyframes sk{0%,100%{transform:translateX(0);}25%{transform:translateX(-8px);}50%{transform:translateX(8px);}75%{transform:translateX(-5px);}}
.gbot{width:100%;flex-shrink:0;z-index:20;background:var(--bot);backdrop-filter:blur(8px);
  border-top:1px solid rgba(0,0,0,.06);padding:8px 10px calc(env(safe-area-inset-bottom,8px) + 6px);}
.gsr{display:flex;justify-content:center;margin-bottom:8px;gap:8px;}
.btn-sp{padding:8px 18px;font-size:12px;border-radius:20px;background:linear-gradient(180deg,#ddeeff,#ccddff);color:var(--pb);border:1px solid rgba(68,170,255,.3);font-weight:700;}
.btn-qt{padding:8px 14px;font-size:11px;border-radius:20px;background:rgba(0,0,0,.04);color:var(--dim);}
.choices{display:grid;grid-template-columns:repeat(3,1fr);gap:7px;max-width:500px;margin:0 auto;}
.ch{font-family:'Dela Gothic One',sans-serif;font-size:clamp(20px,4.5vw,28px);padding:14px 0;border-radius:12px;
  cursor:pointer;text-align:center;transition:all .1s;color:#fff;border:3px solid rgba(255,255,255,.5);
  box-shadow:inset 0 2px 0 rgba(255,255,255,.35),inset 0 -3px 0 rgba(0,0,0,.1),0 3px 0 rgba(0,0,0,.08);}
.ch:nth-child(1){background:linear-gradient(180deg,#ff8899,#ff5577);}
.ch:nth-child(2){background:linear-gradient(180deg,#66bbff,#3399ee);}
.ch:nth-child(3){background:linear-gradient(180deg,#66ee88,#33bb55);}
.ch:nth-child(4){background:linear-gradient(180deg,#ffdd55,#eebb00);color:#665500;}
.ch:nth-child(5){background:linear-gradient(180deg,#bb88ff,#9955ee);}
.ch:nth-child(6){background:linear-gradient(180deg,#ffaa66,#ee7733);}
.ch:active{transform:scale(.9) translateY(2px);}
.ch.cok{filter:brightness(1.6);border-color:#fff;}.ch.cng{filter:brightness(.6) grayscale(.4);border-color:var(--dng);}
#result{justify-content:center;gap:16px;padding:20px;background:linear-gradient(180deg,#d4ecff,var(--bg));overflow-y:auto;}
.rc{background:var(--card);backdrop-filter:blur(8px);border:2px solid rgba(0,0,0,.06);border-radius:22px;
  padding:28px 22px;text-align:center;max-width:480px;width:100%;}
.rci{font-size:48px;margin-bottom:2px;}
.rrk{font-family:'Dela Gothic One',sans-serif;font-size:52px;margin-bottom:4px;letter-spacing:4px;}
.rrk.rs{color:var(--py);animation:rg 1s ease-in-out infinite alternate;}
@keyframes rg{0%{text-shadow:0 0 8px var(--py);}100%{text-shadow:0 0 24px var(--py),0 0 48px var(--po);}}
.rstr{font-size:28px;margin-bottom:8px;}
.rtt{font-family:'Dela Gothic One',sans-serif;font-size:20px;margin-bottom:3px;}
.rsu{font-size:12px;color:var(--dim);margin-bottom:14px;}
.rsts{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:14px;}
.rst{background:rgba(0,0,0,.03);border-radius:12px;padding:12px 6px;}
.rsv{font-family:'Dela Gothic One',sans-serif;font-size:22px;}.rsl{font-size:10px;color:var(--dim);margin-top:3px;}
.ralt{background:var(--altbg);border:2px solid rgba(34,187,85,.2);border-radius:14px;padding:14px;margin-bottom:14px;}
.rae{font-family:'Dela Gothic One',sans-serif;font-size:28px;color:var(--alt);}
.rad{font-size:11px;color:#558866;margin-top:4px;line-height:1.6;}
.rat{font-size:13px;color:#558866;margin-top:8px;}
.rmsg{font-size:12px;color:var(--dim);line-height:1.5;margin-bottom:16px;padding:10px;background:rgba(0,0,0,.02);border-radius:10px;}
.rbtns{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;}
.btn-rm{padding:12px 28px;font-size:14px;border-radius:50px;background:linear-gradient(180deg,#ff8899,#ff5577);color:#fff;box-shadow:0 3px 0 #cc3355;}
.btn-rr{padding:12px 28px;font-size:14px;border-radius:50px;background:rgba(0,0,0,.05);color:var(--txt);}
.goov{display:none;position:fixed;inset:0;background:rgba(255,255,255,.85);backdrop-filter:blur(8px);z-index:100;
  justify-content:center;align-items:center;flex-direction:column;gap:16px;}
.goov.active{display:flex;}
.got{font-family:'Dela Gothic One',sans-serif;font-size:40px;color:var(--dng);animation:gpp .5s ease-in-out infinite alternate;}
@keyframes gpp{0%{transform:scale(1);}100%{transform:scale(1.04);}}
.gos{color:var(--dim);font-size:14px;}
.btn-gok{padding:12px 32px;font-size:16px;background:linear-gradient(180deg,var(--pb),#2288dd);color:#fff;border-radius:50px;box-shadow:0 3px 0 #1166aa;}
.champ{display:none;position:fixed;inset:0;background:rgba(255,255,255,.9);backdrop-filter:blur(8px);z-index:200;
  justify-content:center;align-items:center;flex-direction:column;gap:18px;}
.champ.active{display:flex;}
.chpt{font-family:'Dela Gothic One',sans-serif;font-size:clamp(26px,7vw,44px);color:var(--pr);text-align:center;}
.chps{font-size:44px;}.chpd{font-size:14px;color:var(--dim);text-align:center;}
.btn-ch{padding:12px 32px;font-size:16px;background:linear-gradient(180deg,var(--py),#ddaa00);color:#554400;border-radius:50px;box-shadow:0 3px 0 #aa8800;}
/* TABLET (600px+) */
@media(min-width:600px){
  .gtop{padding:10px 24px;}.ginf{font-size:16px;}.grt{gap:12px;font-size:14px;}
  .gpan{padding:12px 20px;gap:8px;}.panel{max-width:600px;padding:18px 20px;font-size:34px;border-radius:16px;}
  .gbot{padding:10px 20px calc(env(safe-area-inset-bottom,10px) + 8px);}
  .choices{max-width:560px;gap:10px;}.ch{font-size:28px;padding:18px 0;border-radius:14px;}
  .btn-sp{font-size:14px;padding:10px 24px;}
  .alt-badge{font-size:17px;padding:8px 18px;top:16px;right:16px;}
  .float-alt{font-size:34px;}
  .rc{max-width:520px;padding:32px 28px;}.rrk{font-size:60px;}.rae{font-size:32px;}
}
/* MEDIUM TABLET (768px+) */
@media(min-width:768px){
  #map{padding:28px 32px;gap:20px;padding-bottom:280px;}
  .grid{grid-template-columns:repeat(2,1fr);max-width:1000px;gap:18px;}
  .lsec{max-width:1000px;}
  .panel{max-width:680px;font-size:36px;}.choices{max-width:620px;}.ch{font-size:30px;padding:20px 0;}
}
/* LARGE TABLET / iPad 13" (1024px+) */
@media(min-width:1024px){
  #map{padding:36px 40px;gap:24px;}
  .grid{grid-template-columns:repeat(3,1fr);max-width:1100px;gap:20px;}
  .cd{padding:26px 24px;}.cd-e{font-size:38px;margin-bottom:6px;}.cd-n{font-size:21px;margin-bottom:5px;}
  .cd-s{font-size:14px;margin-bottom:8px;}.cd-d{font-size:14px;}.cd-b{font-size:13px;}
  .lsec{max-width:1100px;padding:26px;}.lt{font-size:18px;margin-bottom:14px;}
  .li{font-size:16px;padding:12px 16px;}.btn-ln{font-size:16px;padding:12px 24px;}.lnt{font-size:13px;}
  .mt{font-size:clamp(24px,4vw,34px);}.ts{font-size:17px;}
  .logo{font-size:clamp(52px,8vw,88px);}.tsub{font-size:clamp(14px,2.5vw,20px);}
  .btn-start{font-size:26px;padding:20px 60px;}
  .gtop{padding:14px 32px;}.ginf{font-size:18px;}.grt{font-size:16px;gap:16px;}
  .grt span{padding:6px 14px;}
  .gpan{padding:16px 28px;gap:10px;}
  .panel{max-width:800px;padding:22px 28px;font-size:42px;border-radius:18px;}
  .gbot{padding:14px 28px calc(env(safe-area-inset-bottom,12px) + 10px);}
  .gsr{gap:12px;margin-bottom:10px;}
  .btn-sp{font-size:16px;padding:12px 28px;}.btn-qt{font-size:13px;padding:10px 20px;}
  .choices{max-width:740px;gap:12px;}
  .ch{font-size:34px;padding:22px 0;border-radius:16px;}
  .alt-badge{font-size:19px;padding:10px 22px;top:18px;right:18px;gap:7px;}
  .float-alt{font-size:40px;}
  #result{padding:28px;gap:20px;}
  .rc{max-width:640px;padding:40px 36px;border-radius:26px;}
  .rci{font-size:56px;}.rrk{font-size:68px;letter-spacing:5px;}
  .rstr{font-size:34px;}.rtt{font-size:24px;}.rsu{font-size:14px;margin-bottom:18px;}
  .rsts{gap:14px;margin-bottom:18px;}.rsv{font-size:28px;}.rsl{font-size:12px;}
  .rst{padding:16px 10px;border-radius:14px;}
  .ralt{padding:18px;border-radius:16px;margin-bottom:18px;}.rae{font-size:36px;}.rad{font-size:13px;}
  .rmsg{font-size:14px;padding:14px;border-radius:12px;margin-bottom:20px;}
  .btn-rm,.btn-rr{font-size:16px;padding:14px 34px;}
  .got{font-size:50px;}.gos{font-size:16px;}.btn-gok{font-size:18px;padding:16px 40px;}
  .chpt{font-size:clamp(32px,6vw,52px);}.chps{font-size:52px;}.chpd{font-size:16px;}
  .btn-ch{font-size:18px;padding:14px 38px;}
  .lct{font-size:22px;}.lcw{font-size:15px;}
  .btn-lcc,.btn-lco{font-size:16px;padding:12px 30px;}
}
/* DESKTOP (1200px+) */
@media(min-width:1200px){
  .grid{max-width:1200px;}.lsec{max-width:1200px;}
  .panel{max-width:860px;font-size:44px;}.choices{max-width:800px;}.ch{font-size:36px;padding:24px 0;}
  .rc{max-width:700px;padding:44px 40px;}
}
/* MOBILE */
@media(max-width:599px){.grid{grid-template-columns:1fr;}}
</style>
</head>
<body>
<div class="bubbles" id="bub"></div>
<div class="alt-badge" id="aB">ü™ô <span id="aT">0</span> ALT</div>

<div id="title" class="screen active">
  <div class="logo"><span class="l1">Êöó</span><span class="l2">ÁÆó</span><br><span class="l3">„Éë</span><span class="l4">„Éç</span><span class="l5">„É´</span></div>
  <div class="tsub">„Éë„Éç„É´„ÇíÊöóÁÆó„ÅßÊíÉÁ†¥„Åõ„ÇàÔºÅ</div>
  <button class="btn btn-start" onclick="showMap()">START</button>
</div>

<div id="map" class="screen">
  <div class="mt">üéÆ „Çπ„ÉÜ„Éº„Ç∏ÈÅ∏Êäû</div>
  <div class="ts" id="ts"></div>
  <div class="grid" id="grid"></div>
  <div class="lsec">
    <div class="lt">üí∞ ALT„ÇíTRAIL„Å´Â†±Âëä„Åô„Çã</div>
    <div class="lr"><input class="li" id="lnm" placeholder="„Å™„Åæ„Åà„ÇíÂÖ•Âäõ" maxlength="20" oninput="ulb()">
      <button class="btn btn-ln" id="lbtn" disabled onclick="slc()">üí¨ LINE„ÅßÂ†±Âëä„Åô„Çã</button></div>
    <div class="lnt">Â†±Âëä„Åô„Çã„Å®ALT„ÅØ„É™„Çª„ÉÉ„Éà„Åï„Çå„Åæ„Åô</div>
  </div>
</div>

<div id="game" class="screen">
  <div class="gtop"><div class="ginf" id="gi">‰πù‰πù</div>
    <div class="grt"><span>‚è±<span id="gt">60</span></span><span>üí∞<span id="gsc">0</span></span><span>üì¶<span id="gpc">0</span>/7</span></div>
  </div>
  <div class="gtb"><div class="gtf" id="gtf" style="width:100%"></div></div>
  <div class="gdz"><div class="gdl"></div><div class="gdlb">‚ñº 7Êûö„ÅßOUT</div></div>
  <div class="gpan" id="gp"></div>
  <div class="gbot">
    <div class="gsr"><button class="btn btn-sp" onclick="mSpawn()">Ôºã „Éë„Éç„É´ËøΩÂä†</button><button class="btn btn-qt" onclick="qGame()">„ÇÑ„ÇÅ„Çã</button></div>
    <div class="choices" id="chs"></div>
  </div>
</div>

<div class="goov" id="goOv"><div class="got">GAME OVER</div><div class="gos" id="goS"></div>
  <button class="btn btn-gok" onclick="toRes()">ÁµêÊûú„ÇíË¶ã„Çã</button></div>

<div id="result" class="screen"><div class="rc">
  <div class="rci" id="rci"></div><div class="rrk" id="rrk"></div><div class="rstr" id="rst"></div>
  <div class="rtt" id="rct"></div><div class="rsu" id="rcs"></div>
  <div class="rsts">
    <div class="rst"><div class="rsv" id="rvs">0</div><div class="rsl">„Çπ„Ç≥„Ç¢</div></div>
    <div class="rst"><div class="rsv" id="rvc">0</div><div class="rsl">ÊíÉÁ†¥Êï∞</div></div>
    <div class="rst"><div class="rsv" id="rvk">0</div><div class="rsl">ÊúÄÈ´òÈÄ£Á∂ö</div></div>
  </div>
  <div class="ralt"><div class="rae" id="rae"></div><div class="rad" id="rad"></div><div class="rat" id="rat"></div></div>
  <div class="rmsg" id="rmsg"></div>
  <div class="rbtns"><button class="btn btn-rm" onclick="showMap()">„Éû„ÉÉ„Éó„Å∏</button><button class="btn btn-rr" onclick="rty()">„ÇÇ„ÅÜ‰∏ÄÂ∫¶</button></div>
</div></div>

<div class="champ" id="champ"><div class="chps">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div><div class="chpt">ÊöóÁÆó„Éû„Çπ„Çø„ÉºÔºÅ</div>
  <div class="chpd">ÂÖ®„Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢ÔºÅ</div><button class="btn btn-ch" onclick="E('champ').classList.remove('active')">OK</button></div>

<div class="lcf" id="lcfm"><div class="lct" id="lctx"></div><div class="lcw">ÈÄÅ‰ø°Âæå„ÄÅALT„ÅØ0„Å´Êàª„Çä„Åæ„Åô</div>
  <div class="lcb"><button class="btn btn-lcc" onclick="E('lcfm').classList.remove('active')">„ÇÑ„ÇÅ„Çã</button>
    <button class="btn btn-lco" onclick="doLine()">OKÔºÅÈÄÅ„Çã</button></div></div>

<script>
// ‚îÄ‚îÄ‚îÄ TRAIL ALT„Éª„É©„É≥„Ç≠„É≥„Ç∞ÈÄ£Êê∫ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const GAS_URL     = 'https://script.google.com/macros/s/AKfycbzKUyiUHIMp9JRFX0LEa88plEoavkbrjTQ5oHf9T-FDd6b4fhqfTCBVBy5rWUZPUQbY/exec';
const GAME_ID     = 6;
const GAME_NAME   = 'ÊöóÁÆó„Éë„Éç„É´';
const SCORE_LABEL = 'pt';
const ALT_AMOUNT  = 10;
const TRAIL_PLAYER = new URLSearchParams(location.search).get('player') || null;

async function sendResult(score) {
  if (!TRAIL_PLAYER) return;
  const opt = { method:'POST', redirect:'follow', headers:{'Content-Type':'text/plain'} };
  await fetch(GAS_URL, { ...opt, body: JSON.stringify({
    action: 'saveRanking',
    gameId: GAME_ID, gameName: GAME_NAME,
    player: TRAIL_PLAYER, score: score, scoreLabel: SCORE_LABEL
  })});
  await fetch(GAS_URL, { ...opt, body: JSON.stringify({
    action: 'addCoin',
    player: TRAIL_PLAYER, gameId: GAME_ID,
    gameName: GAME_NAME, amount: ALT_AMOUNT
  })});
}
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// === UTIL ===
function ri(a,b){return~~(Math.random()*(b-a+1))+a;}
function rc(a){return a[~~(Math.random()*a.length)];}
function E(id){return document.getElementById(id);}
function show(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));E(id).classList.add('active');}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=ri(0,i);[a[i],a[j]]=[a[j],a[i]];}return a;}
function updAlt(){E('aT').textContent=S.alt;}

// === BUBBLES ===
const BC=['#ff5577','#44aaff','#44dd77','#ffcc22','#aa66ff','#ff8844'],bC=E('bub');
let bI=0;
function bSp(){if(bI>=2)return{d:[2,4],dl:[0,1],n:10};if(bI>=1)return{d:[4,6],dl:[0,2],n:7};return{d:[8,12],dl:[0,4],n:5};}
function mB(){const s=bSp(),b=document.createElement('div');b.className='bubble';const z=Math.random()*50+15;
  b.style.cssText=`width:${z}px;height:${z}px;left:${Math.random()*100}%;background:${BC[~~(Math.random()*6)]};animation-duration:${Math.random()*(s.d[1]-s.d[0])+s.d[0]}s;animation-delay:${Math.random()*(s.dl[1]-s.dl[0])+s.dl[0]}s`;
  bC.appendChild(b);b.addEventListener('animationend',()=>{b.remove();mB();});}
function uBI(){if(!G||G.ended){bI=0;return;}let l=0;if(G.combo>=3)l++;if(G.timeLeft<=15)l++;if(G.panels.length>=5)l++;bI=Math.min(2,l);
  const t=bSp().n;if(bC.children.length<t)for(let i=bC.children.length;i<t;i++)mB();}
for(let i=0;i<5;i++)mB();

// === STAGES ===
const STG=[
  {key:'kuku',name:'‰πù‰πù',emoji:'üî¥',sub:'1„Ç±„Çø√ó1„Ç±„Çø',desc:'Âü∫Êú¨„ÅÆ„Åã„ÅëÁÆó',color:'#ff5577',diff:'easy',
    gen(){const a=ri(2,9),b=ri(2,9);return{text:`${a} √ó ${b}`,ans:a*b};}},
  {key:'big',name:'√ó10„ÅÆ„Åã„ÅëÁÆó',emoji:'üü†',sub:'Â§ß„Åç„ÅÑÊï∞„ÅÆ„Åã„ÅëÁÆó',desc:'10„Éª100„ÅÆ‰Ωç',color:'#ff8844',diff:'easy',
    gen(){const p=[()=>{const a=rc([10,20,30,40,50,60,70,80,90]),b=ri(2,9);return{text:`${a}√ó${b}`,ans:a*b};},
      ()=>{const a=rc([100,200,300,400,500]),b=ri(2,9);return{text:`${a}√ó${b}`,ans:a*b};},
      ()=>{const a=ri(2,9),b=rc([11,12,13,14,15]);return{text:`${a}√ó${b}`,ans:a*b};},
      ()=>{const a=rc([20,30,40,50]),b=rc([20,30,40,50]);return{text:`${a}√ó${b}`,ans:a*b};}];return rc(p)();}},
  {key:'div',name:'„Çè„ÇäÁÆó',emoji:'üü¢',sub:'„ÅÇ„Åæ„Çä„Å™„Åó„ÅÆ„Çè„ÇäÁÆó',desc:'„Çè„ÇäÂàá„Çå„Çã„Çè„ÇäÁÆó',color:'#44dd77',diff:'normal',
    gen(){const b=ri(2,9),c=ri(2,12),a=b*c;return{text:`${a} √∑ ${b}`,ans:c};}},
  {key:'rev',name:'ÈÄÜÁÆó„ÉªÁ©¥„ÅÜ„ÇÅ',emoji:'üîµ',sub:'‚ñ°„ÇíÊ±Ç„ÇÅ„Çà„ÅÜ',desc:'Á©¥„ÅÜ„ÇÅË®àÁÆó',color:'#44aaff',diff:'hard',
    gen(){const t=ri(0,3);if(t===0){const a=ri(2,9),b=ri(2,9);return{text:`‚ñ°√ó${b}=${a*b}`,ans:a};}
      if(t===1){const a=ri(2,9),b=ri(2,9);return{text:`${a}√ó‚ñ°=${a*b}`,ans:b};}
      if(t===2){const b=ri(2,9),c=ri(2,12);return{text:`${b*c}√∑‚ñ°=${c}`,ans:b};}
      const b=ri(2,9),c=ri(2,9);return{text:`‚ñ°√∑${b}=${c}`,ans:b*c};}},
  {key:'mix',name:'Á∑èÂêà„Éü„ÉÉ„ÇØ„Çπ',emoji:'üü£',sub:'ÂÖ®„Çø„Ç§„ÉóÊ∑∑Âêà',desc:'„É©„É≥„ÉÄ„É†Âá∫È°å',color:'#aa66ff',diff:'hard',
    gen(){return rc([STG[0],STG[1],STG[2],STG[3]]).gen();}}
];

const MXP=7,GTIM=60,SSMS=4000,SMIN=800,SACC=250,BPT=10,FEVAT=3,FEVM=2,CLTH=15,PCC=6;
let S={cleared:{},best:{},alt:0,fc:{}};
let G=null;

function floatN(n){
  if(n===0)return;
  const el=document.createElement('div');el.className='float-alt';
  el.textContent=n>0?`+${n}`:`${n}`;
  if(n<0)el.style.color='var(--dng)';
  el.style.left=(Math.random()*30+35)+'%';el.style.top='38%';
  document.body.appendChild(el);el.addEventListener('animationend',()=>el.remove());
}

function makeC(ans){
  const s=new Set([ans]);let t=0;
  while(s.size<6&&t<100){t++;let d;const r=Math.random();
    if(r<.3)d=ans+rc([-3,-2,-1,1,2,3]);
    else if(r<.6){const rng=Math.max(3,~~(ans*.2));d=ans+ri(-rng,rng);}
    else{if(ans>=10&&ans<100){const a=~~(ans/10),b=ans%10;d=b*10+a;}else d=ans+rc([-5,-4,-3,-2,-1,1,2,3,4,5,10,-10]);}
    if(d>0&&d!==ans)s.add(d);}
  let f=1;while(s.size<6){s.add(ans+f);f=f>0?-f:(-f+1);}
  return shuffle([...s]);
}

// === ALT CALC ===
function altForCorrect(combo){
  if(combo>=4)return 1;
  return 0;
}
function altPenalty(diff){
  if(diff==='easy')return 3;
  if(diff==='normal')return 2;
  return 1; // hard
}
function starRating(score,destroyed){
  if(score>=300)return 3;
  if(score>=130)return 2;
  if(destroyed>=CLTH)return 1;
  return 0;
}
function starBonus(stars){if(stars===3)return 5;if(stars===2)return 3;if(stars===1)return 1;return 0;}

// === MAP ===
function showMap(){
  show('map');E('aB').classList.remove('hide');updAlt();
  const g=E('grid');g.innerHTML='';let st=0;
  STG.forEach((s,i)=>{if(S.cleared[s.key])st++;
    const d=document.createElement('div');d.className='cd'+(S.cleared[s.key]?' cl':'');d.dataset.i=i;
    d.onclick=()=>startG(i);
    d.innerHTML=`<div class="cd-e">${s.emoji}</div><div class="cd-n" style="color:${s.color}">${s.name}</div>
      <div class="cd-s">${s.sub}</div><div class="cd-d">${s.desc}</div>
      ${S.best[s.key]?`<div class="cd-b">„Éô„Çπ„Éà: ${S.best[s.key]}pt</div>`:''}`;
    g.appendChild(d);});
  E('ts').innerHTML=`<span class="si" style="color:var(--py)">‚≠ê</span> ${st} / 5`;
}

// === GAME ===
function startG(idx){
  const s=STG[idx];
  G={idx,stage:s,panels:[],selId:null,score:0,combo:0,maxCombo:0,destroyed:0,totalQ:0,
    timeLeft:GTIM,spInt:SSMS,spTmr:null,clkTmr:null,nxId:0,ended:false,cIdx:0,
    altEarned:0,altLost:0,altDetail:[]};
  show('game');E('aB').classList.add('hide');
  E('gi').textContent=`${s.emoji} ${s.name}`;E('gi').style.color=s.color;
  E('gp').innerHTML='';E('gsc').textContent='0';E('gpc').textContent='0';
  E('gt').textContent=GTIM;E('gtf').style.width='100%';E('gtf').className='gtf';
  E('goOv').classList.remove('active');E('chs').innerHTML='';
  G.clkTmr=setInterval(clkTick,1000);spawnP();schedSp();
}

function clkTick(){
  if(!G||G.ended)return;G.timeLeft--;E('gt').textContent=Math.max(0,G.timeLeft);
  const p=(G.timeLeft/GTIM)*100,f=E('gtf');
  f.style.width=p+'%';f.className='gtf'+(p<15?' td':p<40?' tw':'');
  uBI();if(G.timeLeft<=0)endG(true);
}

function schedSp(){
  if(!G||G.ended)return;
  G.spTmr=setTimeout(()=>{if(!G||G.ended)return;spawnP();
    G.spInt=Math.max(SMIN,G.spInt-SACC);schedSp();},G.spInt);
}

function spawnP(){
  if(!G||G.ended)return;
  const q=G.stage.gen(),id=G.nxId++,ch=makeC(q.ans),ci=G.cIdx%PCC;G.cIdx++;
  const pan={id,text:q.text,ans:q.ans,choices:ch,el:null,done:false};
  const el=document.createElement('div');el.className=`panel pc${ci}`;el.textContent=q.text;
  el.onclick=()=>selP(id);pan.el=el;
  G.panels.push(pan);E('gp').appendChild(el);updPC();autoSel();
  if(G.panels.length>=MXP)endG(false);
}

function mSpawn(){if(!G||G.ended||G.panels.length>=MXP-1)return;spawnP();}
function autoSel(){if(!G||!G.panels.length)return;selP(G.panels[0].id);}

function selP(id){
  if(!G||G.ended)return;
  G.panels.forEach(p=>p.el.classList.remove('sel'));
  G.selId=id;const p=G.panels.find(x=>x.id===id);
  if(p){p.el.classList.add('sel');renC(p);}
}

function updPC(){if(G)E('gpc').textContent=G.panels.length;}

function renC(pan){
  const w=E('chs');w.innerHTML='';
  pan.choices.forEach(v=>{const b=document.createElement('button');b.className='ch';b.textContent=v;
    b.onclick=()=>pick(pan,v,b);w.appendChild(b);});
}

function pick(pan,v,btn){
  if(!G||G.ended||pan.done)return;
  G.totalQ++;
  if(v===pan.ans){
    // CORRECT
    pan.done=true;btn.classList.add('cok');
    pan.el.classList.remove('sel');pan.el.classList.add('shatter');
    G.combo++;if(G.combo>G.maxCombo)G.maxCombo=G.combo;
    const mult=G.combo>=FEVAT?FEVM:1;G.score+=BPT*mult;G.destroyed++;E('gsc').textContent=G.score;
    // ALT
    const a=altForCorrect(G.combo);G.altEarned+=a;floatN(a);
    uBI();
    const idx=G.panels.findIndex(x=>x.id===pan.id);if(idx>=0)G.panels.splice(idx,1);
    updPC();if(G.panels.length>0)autoSel();else spawnP();
    setTimeout(()=>pan.el.remove(),250);
  } else {
    // WRONG
    G.combo=0;
    const pen=altPenalty(G.stage.diff);G.altLost+=pen;floatN(-pen);
    G.timeLeft=Math.max(0,G.timeLeft-2);E('gt').textContent=Math.max(0,G.timeLeft);
    btn.classList.add('cng');pan.el.classList.add('shake');
    uBI();
    setTimeout(()=>{btn.classList.remove('cng');pan.el.classList.remove('shake');},250);
    if(G.timeLeft<=0)endG(true);
  }
}

function endG(survived){
  if(!G||G.ended)return;G.ended=true;clearInterval(G.clkTmr);clearTimeout(G.spTmr);
  if(!survived){E('goS').textContent='„Éë„Éç„É´„Åå7Êûö„Åü„Åæ„Å£„Åü‚Ä¶';E('goOv').classList.add('active');}
  else toRes();
}

function toRes(){
  E('goOv').classList.remove('active');E('aB').classList.remove('hide');
  const s=G.stage,d=G.destroyed,sc=G.score;
  const stars=starRating(sc,d);
  const passed=d>=CLTH;
  if(passed){S.cleared[s.key]=true;sendResult(sc);}
  if(!S.best[s.key]||sc>S.best[s.key])S.best[s.key]=sc;

  // ALT bonuses
  const details=[];
  details.push(`Ê≠£Ëß£Â†±ÈÖ¨: +${G.altEarned} ALT`);
  if(G.altLost>0) details.push(`‰∏çÊ≠£Ëß£„Éö„Éä„É´„ÉÜ„Ç£: -${G.altLost} ALT`);
  let bonus=0;
  if(stars>0){const sb=starBonus(stars);bonus+=sb;details.push(`${'‚òÖ'.repeat(stars)}${'‚òÜ'.repeat(3-stars)} „ÇØ„É™„Ç¢„Éú„Éº„Éä„Çπ: +${sb} ALT`);}
  const isFirst=passed&&!S.fc[s.key];
  if(isFirst){bonus+=8;details.push(`üéâ Âàù„ÇØ„É™„Ç¢„Éú„Éº„Éä„Çπ: +8 ALT`);S.fc[s.key]=true;}
  const netAlt=Math.max(0,G.altEarned-G.altLost+bonus);
  details.push(`„Çπ„Ç≥„Ç¢: ${sc}pt`);
  S.alt+=netAlt;
  updAlt();

  // Rank
  const rank=calcRank(sc);
  show('result');
  E('rci').textContent=rank.icon;
  E('rrk').textContent=rank.label;E('rrk').style.color=rank.color;
  E('rrk').className=rank.label==='S'?'rrk rs':'rrk';
  E('rst').textContent=stars>0?'‚òÖ'.repeat(stars)+'‚òÜ'.repeat(3-stars):'‚òÜ‚òÜ‚òÜ';
  E('rct').textContent=passed?`${s.name} „ÇØ„É™„Ç¢ÔºÅ`:s.name;
  E('rcs').textContent=passed?`${CLTH}ÂïèÊíÉÁ†¥„Åß„ÇØ„É™„Ç¢`:`${CLTH}ÂïèÊíÉÁ†¥„Åß„ÇØ„É™„Ç¢Ôºà${d}ÂïèÔºâ`;
  E('rvs').textContent=sc;E('rvc').textContent=d;E('rvk').textContent=G.maxCombo;
  E('rae').textContent=`+${netAlt} ALT`;
  E('rad').textContent=details.join('\n');
  E('rat').textContent=`Á¥ØË®à: ${S.alt} ALT`;
  let msg='';if(G.timeLeft<=0&&passed)msg='60ÁßíÁîü„ÅçÊÆã„Å£„ÅüÔºÅ';
  else if(G.timeLeft<=0)msg='Áîü„ÅçÊÆã„Å£„Åü„Åå„ÇØ„É™„Ç¢„Å´„ÅØË∂≥„Çä„Å™„ÅÑ„ÄÇÂÜçÊåëÊà¶ÔºÅ';
  else msg=`„Éë„Éç„É´„ÅåÊ∫¢„Çå„Åü„ÄÇ${d}ÂïèÊíÉÁ†¥„ÄÇ`;
  E('rmsg').textContent=msg;
  if(passed){const all=STG.every(x=>S.cleared[x.key]);if(all)setTimeout(()=>E('champ').classList.add('active'),800);}
}

function qGame(){if(!G)return;if(confirm('„Éû„ÉÉ„Éó„Å´Êàª„ÇãÔºü')){G.ended=true;clearInterval(G.clkTmr);clearTimeout(G.spTmr);showMap();}}
function rty(){if(G)startG(G.idx);}

function calcRank(sc){
  if(sc>=300)return{label:'S',icon:'üëë',color:'#ff5577'};
  if(sc>=200)return{label:'A',icon:'‚≠ê',color:'#ff8844'};
  if(sc>=130)return{label:'B',icon:'‚≠ê',color:'#44aaff'};
  if(sc>=80)return{label:'C',icon:'üåô',color:'#44dd77'};
  return{label:'D',icon:'üåô',color:'#7788aa'};
}

// === LINE ===
function ulb(){
  const nm=E('lnm').value.trim();
  E('lbtn').disabled=!(nm&&S.alt>0);
}
function slc(){
  E('lctx').textContent=`‚ö†Ô∏è ${S.alt}ALT„ÇíÂ†±Âëä„Åó„Å¶„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô`;
  E('lcfm').classList.add('active');
}
function doLine(){
  E('lcfm').classList.remove('active');
  const nm=E('lnm').value.trim();
  const clr=STG.filter(s=>S.cleared[s.key]).length;
  const msg=`„ÄêÊöóÁÆó„Éë„Éç„É´ ALTÂ†±Âëä„Äë\nÂêçÂâç: ${nm}\nüí∞ ${S.alt}ALT\n„ÇØ„É™„Ç¢: ${clr}/5„Çπ„ÉÜ„Éº„Ç∏\n„Éô„Çπ„Éà: ${Object.values(S.best).length?Math.max(...Object.values(S.best)):0}pt`;
  const url='https://line.me/R/oaMessage/@trail_official/?'+encodeURIComponent(msg);
  window.open(url,'_blank');
  S.alt=0;updAlt();ulb();
}

// === KEYBOARD ===
document.addEventListener('keydown',e=>{
  if(!E('game').classList.contains('active')||!G||G.ended)return;
  const n=parseInt(e.key);if(n>=1&&n<=6){const b=E('chs').querySelectorAll('.ch');if(b[n-1])b[n-1].click();}
});
</script>
</body>
</html>
